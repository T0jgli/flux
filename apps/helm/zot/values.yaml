image:
  repository: ghcr.io/project-zot/zot-linux-arm64

persistence: true
pvc:
  create: true

externalSecrets:
  - secretName: "registry-credentials"
    mountPath: "/secrets/registry-credentials"

mountConfig: true
configFiles:
  config.json: |-
    {
        "storage": {
            "rootDirectory": "/var/lib/registry"
        },
        "http": {
            "address": "0.0.0.0",
            "port": "5000",
            "auth": {
                "htpasswd": {
                    "path": "/secrets/registry-credentials"
                }
            },
            "accessControl": {
                "repositories": {
                    "**": {
                        "policies": [
                            {
                                "users": [
                                    "local"
                                ],
                                "actions": [
                                    "read",
                                    "create",
                                    "update",
                                    "delete"
                                ]
                            }
                        ]
                    }
                }
            }
        },
        "log": {
            "level": "debug"
        }
    }

ingress:
  enabled: true
  className: nginx-internal
  annotations:
    cert-manager.io/cluster-issuer: "custom-ca-issuer"
    nginx.ingress.kubernetes.io/server-snippet: |
      if ($scheme = http) {
        return 301 https://$host:8443$request_uri;
      }
    nginx.ingress.kubernetes.io/proxy-body-size: "0"
    nginx.ingress.kubernetes.io/proxy-read-timeout: "600"
    nginx.ingress.kubernetes.io/proxy-send-timeout: "600"
  hosts:
    - host: zot.kvlk.local
      paths:
        - path: /
  tls:
    - hosts:
        - zot.kvlk.local
      secretName: zot-tls

strategy:
  type: Recreate
